# THE MASTER BRIEF - World-Class Metals Quant Model
## Version 1.0 | November 4, 2025
### Living Document - Updated Each Major Milestone

---

## üéØ MISSION STATEMENT

**Build the best base metals quantitative model by combining:**
- Renaissance-style systematic rigor (ex-quant approach)
- Deep fundamental market knowledge (experienced PM intuition)
- Adaptive, regime-aware execution
- Auditable, understandable decision-making

**Target:** Production-ready copper model with Sharpe 0.85+, then extend to full metals basket.

---

## üìä CURRENT STATE SNAPSHOT

### **Portfolio Performance (as of Nov 1, 2025)**

| Sleeve | Sharpe | Ann Return | Ann Vol | Max DD | Activity | Status |
|--------|--------|------------|---------|--------|----------|--------|
| **TrendCore v3** | 0.51 | 2.34% | 4.61% | -14.4% | 98.5% | ‚úÖ **GOOD** |
| **TrendImpulse v4** | 0.42 | 4.86% | 11.55% | -32.3% | 90.1% | ‚ö†Ô∏è **OK** |
| **HookCore v4** | 0.26 | 0.69% | 2.65% | -15.9% | 7.3% | ‚ùå **WEAK** |

**Best 3-Sleeve Blend (from prior testing):**
- TC 50% / TI 30% / HC 20% ‚Üí **Portfolio Sharpe 0.59**
- Max DD: -7.71% (excellent risk control)
- Low correlations: TC-TI (0.18), TC-HC (0.03), TI-HC (-0.09)

### **Key Strengths**
‚úÖ Solid foundation with 3 working sleeves  
‚úÖ Excellent diversification (correlations <0.2)  
‚úÖ Good risk control (DD <8% in blend)  
‚úÖ Clean infrastructure (Layer A/B separation)  
‚úÖ Proper vol targeting and T‚ÜíT+1 accrual  

### **Key Weaknesses**
‚ùå HookCore dramatically underperforming (0.26 vs target 0.80)  
‚ùå TrendImpulse high turnover (630x/year) and deep drawdowns (-32%)  
‚ùå No regime-aware position sizing yet  
‚ùå Missing choppy market specialist (ChopCore)  
‚ùå No overlays (tightness index, ML attribution, positioning)  

---

## üèóÔ∏è ARCHITECTURE OVERVIEW

### **Two-Layer Design (Immutable)**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              LAYER B - Signal Generation              ‚îÇ
‚îÇ  ‚Ä¢ Sleeves: TrendCore, TrendImpulse, HookCore, etc   ‚îÇ
‚îÇ  ‚Ä¢ Returns pos_raw ‚àà {-1, 0, +1} (or scaled)        ‚îÇ
‚îÇ  ‚Ä¢ All creativity and alpha generation here          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           LAYER A - Execution Contract                ‚îÇ
‚îÇ  ‚Ä¢ Vol targeting (10% ann target per sleeve)         ‚îÇ
‚îÇ  ‚Ä¢ T‚ÜíT+1 PnL accrual (immutable rule)               ‚îÇ
‚îÇ  ‚Ä¢ Cost model (1.5 bps one-way default)              ‚îÇ
‚îÇ  ‚Ä¢ Metrics calculation (Sharpe, DD, vol, etc)        ‚îÇ
‚îÇ  ‚Ä¢ SHARED BY ALL SLEEVES - NEVER MODIFY              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Critical Rule:** Layer A (`contract.py`) is sacred and immutable. All sleeves use identical execution logic.

### **Planned System Architecture**

```
SLEEVES (Signal Generators)
  ‚îú‚îÄ‚îÄ TrendCore v3         ‚Üí 30/100d dual MA, regime-aware scaling
  ‚îú‚îÄ‚îÄ TrendImpulse v4      ‚Üí 20d momentum, asymmetric entry/exit
  ‚îú‚îÄ‚îÄ HookCore v5 (NEXT)   ‚Üí Mean reversion, needs fix
  ‚îî‚îÄ‚îÄ ChopCore v1 (PLAN)   ‚Üí Range-bound specialist
  
OVERLAYS (Position Modifiers)
  ‚îú‚îÄ‚îÄ Tightness Index      ‚Üí Physical market balance (inventory, spreads)
  ‚îú‚îÄ‚îÄ ML Attribution       ‚Üí Driver decomposition (China/USD/Risk/Supply)
  ‚îú‚îÄ‚îÄ Chop Detector        ‚Üí Regime probability scoring
  ‚îî‚îÄ‚îÄ Positioning Data     ‚Üí CFTC/fund flows
  
PORTFOLIO BLENDER (Multi-Sleeve Combiner)
  ‚îú‚îÄ‚îÄ Static Weights       ‚Üí Fixed 50/30/20 type blends
  ‚îú‚îÄ‚îÄ Regime-Aware Weights ‚Üí Dynamic based on vol/trend/chop state
  ‚îî‚îÄ‚îÄ Risk Overlay         ‚Üí Tightness + ML + Chop adjust sizing
```

---

## üìÅ REPOSITORY STRUCTURE

```
C:\Code\Metals\
‚îú‚îÄ‚îÄ src\
‚îÇ   ‚îú‚îÄ‚îÄ core\
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contract.py           # Layer A (IMMUTABLE)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ regime.py             # Regime detection (TODO)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ portfolio.py          # Multi-sleeve blending (TODO)
‚îÇ   ‚îú‚îÄ‚îÄ signals\
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trendcore_v3.py       # ‚úÖ Complete
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trendimpulse_v4.py    # ‚úÖ Complete
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hookcore_v4.py        # ‚ö†Ô∏è Needs improvement
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ chopcore_v1.py        # üîú To build
‚îÇ   ‚îú‚îÄ‚îÄ overlays\                 # üîú New folder
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tightness_index.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ml_attribution.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ positioning.py
‚îÇ   ‚îú‚îÄ‚îÄ cli\
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ build_*.py            # Individual builders
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ build_portfolio.py    # üîú Multi-sleeve
‚îÇ   ‚îî‚îÄ‚îÄ utils\
‚îÇ       ‚îú‚îÄ‚îÄ data_pipeline.py
‚îÇ       ‚îî‚îÄ‚îÄ metrics.py
‚îú‚îÄ‚îÄ Config\
‚îÇ   ‚îú‚îÄ‚îÄ Copper\
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trendcore_v3.yaml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trendimpulse_v4.yaml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hookcore_v4.yaml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ portfolio.yaml        # üîú To create
‚îÇ   ‚îî‚îÄ‚îÄ regimes.yaml              # üîú To create
‚îú‚îÄ‚îÄ Data\
‚îÇ   ‚îú‚îÄ‚îÄ copper\
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pricing\              # ‚úÖ Have: 3mo, 12mo, cash
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ positioning\          # üîú Need: CFTC data
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fundamentals\         # üîú Need: stocks, TC/RCs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ macro\                # üîú Need: PMI, FX, rates
‚îÇ   ‚îî‚îÄ‚îÄ [aluminum, zinc...]       # üîú Phase 2
‚îú‚îÄ‚îÄ outputs\
‚îÇ   ‚îú‚îÄ‚îÄ Copper\
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TrendCore_v3\
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TrendImpulse_v4\
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HookCore_v4\
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Portfolio\            # üîú Combined outputs
‚îÇ   ‚îî‚îÄ‚îÄ backtests\
‚îú‚îÄ‚îÄ notebooks\                    # üîú For analysis
‚îú‚îÄ‚îÄ tests\                        # üîú Unit tests
‚îî‚îÄ‚îÄ docs\                         # üîú Documentation
```

---

## üî¨ SLEEVE SPECIFICATIONS

### **TrendCore v3** ‚úÖ

**Philosophy:** Smart dual-MA trend follower with multi-factor regime scaling

**Signal Logic:**
- Fast MA: 30 days
- Slow MA: 100 days
- Base: +1 if fast > slow, -1 otherwise
- Scaling factors:
  - Range filter (0.3x if tight range <10%)
  - Quality filter (0.5-1.0x based on directional consistency)
  - Vol filter (0.7x if high vol >75th percentile)

**Performance:**
- Sharpe: **0.51** (GOOD - solid foundation)
- Vol: 4.61% (after 10% target)
- Activity: 98.5% (nearly always-on)
- Turnover: ~100x/year (reasonable)

**Regime Performance:**
- Excels in: Low-med vol trends, persistent directional moves
- Struggles in: High vol whipsaws, tight ranges

**Status:** ‚úÖ Production-ready, no changes needed

---

### **TrendImpulse v4** ‚ö†Ô∏è

**Philosophy:** Short-term momentum with asymmetric entry/exit and aggressive regime scaling

**Signal Logic:**
- Momentum window: 20 days
- Entry threshold: 1.0% (need conviction)
- Exit threshold: 0.3% (patient)
- Regime scaling:
  - Low vol (best edge): 1.5x position
  - Medium vol: 0.4x position
  - High vol: 0.7x position
- Weekly vol updates (not daily) to reduce turnover

**Performance:**
- Sharpe: **0.42** (OK but can improve)
- Vol: 11.55% (higher than target, aggressive)
- Activity: 90.1%
- Turnover: 630x/year (‚ö†Ô∏è VERY HIGH - cost drag)
- Max DD: -32.3% (‚ö†Ô∏è concerning)

**Regime Performance:**
- Low vol: Sharpe 0.658 (excellent!)
- Medium vol: Sharpe 0.062 (weak)
- High vol: Sharpe 0.079 (weak)

**Key Insight:** Clear edge in low vol, but high turnover and drawdowns need addressing.

**Potential Improvements:**
1. More aggressive low vol filter (only trade bottom 40% of vol, not 50%)
2. Test faster lookback (15d vs 20d) for lower correlation with TrendCore
3. Dynamic position sizing (scale by momentum strength)

**Status:** ‚ö†Ô∏è Works but needs optimization

---

### **HookCore v4** ‚ùå

**Philosophy:** Mean reversion on extreme moves with volume confirmation

**Signal Logic:**
- Bollinger bands (20d, 2œÉ)
- Volume spike filter (>1.3x average)
- **PROBLEM:** Long-only (no shorts implemented)
- **PROBLEM:** Too selective (7.3% activity = 491 days out of 6,718)
- **PROBLEM:** Volume filter may still be too tight

**Performance:**
- Sharpe: **0.26** (WEAK - below acceptable threshold)
- Vol: 2.65% (low due to inactivity)
- Activity: 7.3% (extremely sparse)
- Max DD: -15.9% (poor for 2.65% vol)
- Position: 100% long / 0% short (broken!)

**Regime Performance:**
- Uptrends: Sharpe 3.27 (‚ö° EXCELLENT edge exists!)
- Medium vol: Sharpe 0.90 (good)
- Low vol: Sharpe -0.67 (loses money)
- Downtrends: Sharpe -5.42 (disasters)

**Root Causes:**
1. No short side ‚Üí can't trade reversals from highs
2. Volume filter too strict ‚Üí missing opportunities
3. No regime filter ‚Üí trades in bad environments (low vol, downtrends)

**Critical Insight:** The edge is PROVEN (Sharpe 3.27 in uptrends), just misconfigured.

**Required Fixes (HIGH PRIORITY):**
1. **Enable shorts** (30 min):
   ```python
   elif price > bb_upper and volume_spike:
       pos = -1  # SHORT (sell rips)
   ```
2. **Regime filter** (1 hour):
   ```python
   # Only trade in uptrends OR medium vol
   is_uptrend = price / price.shift(100) > 1.05
   is_medium_vol = (vol_pct > 0.3) & (vol_pct < 0.7)
   
   if not (is_uptrend or is_medium_vol):
       pos = 0  # Sit out in bad regimes
   ```

**Expected Improvement:** 0.26 ‚Üí 0.60-0.80 Sharpe (2-3x improvement)

**Status:** ‚ùå Needs urgent fix before deployment

---

### **ChopCore v1** üîú (TO BUILD)

**Philosophy:** Range-bound market specialist using Bollinger mean reversion

**Hypothesis:** 
- Markets spend 40-50% of time in rangebound "chop"
- Historical periods: 2011-12, 2012-13, 2015-16, 2018-19
- Trend followers bleed in these environments
- Need a sleeve that makes money when TC/TI struggle

**Planned Signal Logic:**
- Bollinger bands (20d, 2œÉ)
- Enter LONG when price < lower band
- Enter SHORT when price > upper band
- Exit at mean reversion to middle band
- Volume confirmation (spike on entry)
- **Regime filter:** Only trade when chop_probability >0.65

**Target Performance:**
- Sharpe: 0.60+ in rangebound regimes
- Activity: 15-25% (only in chop periods)
- Negative correlation to TrendCore/TrendImpulse

**When to Build:** Week 1, Day 2 (after HookCore fix)

---

## üéØ OKRs - OBJECTIVES & KEY RESULTS

### **Week 1: Quick Wins & Foundations** ‚ö°

**Goal:** Fix obvious issues, build 4-sleeve foundation

**Day 1-2 (HIGH PRIORITY):**
- [ ] Fix HookCore v5:
  - Enable shorts (30 min)
  - Relax volume filter if needed (5 min)  
  - Add regime filter (1 hour)
  - **Target: Sharpe 0.26 ‚Üí 0.60+**
  
- [ ] Build ChopCore v1 (4 hours):
  - Bollinger mean reversion
  - Volume confirmation
  - Chop regime filter
  - **Target: Sharpe 0.50+ in chop periods**

**Day 3-4:**
- [ ] Portfolio Re-Blend:
  - Test improved HookCore + new ChopCore
  - Optimize weights (grid search or Sharpe-weighted)
  - **Target: Portfolio Sharpe 0.70+**

**Day 5:**
- [ ] Regime Detection Framework v1:
  - Vol regime classifier (low/med/high)
  - Trend regime classifier (trending/ranging)
  - Chop probability calculator
  - **Deliverable: Working regime.py module**

**Week 1 Success Criteria:**
- ‚úÖ 4 working sleeves (TC, TI, HC, ChopCore)
- ‚úÖ Portfolio Sharpe >0.70
- ‚úÖ HookCore Sharpe >0.60
- ‚úÖ Regime detection framework built

---

### **Week 2: Regime-Aware System & Overlays** üåç

**Goal:** Adaptive portfolio with tightness/ML overlays

**Day 6-7:**
- [ ] Adaptive Portfolio Blender:
  - Dynamic weight adjustment based on regime
  - Smooth transitions (5-10 day windows)
  - **Target: Portfolio Sharpe 0.75-0.80**

**Day 8-9:**
- [ ] Tightness Index v1:
  - Calculate from LME stocks, cash/3mo spread, cancelled warrants
  - Position sizing overlay (tightness >70 ‚Üí increase longs)
  - **Deliverable: tightness_index.py with backtest**

**Day 10:**
- [ ] ML Attribution System v1:
  - Rolling regression on China/USD/Risk/Supply factors
  - Dominant driver identification
  - **Deliverable: ml_attribution.py with dashboard**

**Week 2 Success Criteria:**
- ‚úÖ Regime-aware dynamic blending working
- ‚úÖ Tightness index integrated
- ‚úÖ ML attribution monitoring live
- ‚úÖ Portfolio Sharpe >0.80

---

### **Week 3-4: Optimization & Production** üöÄ

**Week 3 Focus:**
- Parameter sweeps (test robustness)
- Walk-forward validation (train/test splits)
- Stress testing (2008, 2015-16, 2020 periods)
- **Target: Validated Sharpe >0.85**

**Week 4 Focus:**
- Code cleanup and documentation
- Create runbooks ("How to add a sleeve", "How to update regime rules")
- Set up automated daily runs
- Build monitoring dashboard
- **Deliverable: Production-ready system**

**1-Month Success Criteria:**
- ‚úÖ Full adaptive 4-sleeve system deployed
- ‚úÖ Tightness + ML + Chop detection integrated
- ‚úÖ Portfolio Sharpe >0.85 (validated IS/OOS)
- ‚úÖ Max DD <-25%
- ‚úÖ Clean repo with documentation
- ‚úÖ Ready for live trading (paper or small size)

---

## üî• CRITICAL DECISIONS

### **Decision 1: HookCore - Fix Now or Skip?**

**ANSWER: FIX NOW (Days 1-2)** ‚úÖ

**Rationale:**
- Proven edge exists (Sharpe 3.27 in uptrends)
- Quick wins available (30 min for shorts, 1 hour for regime filter)
- Expected improvement: 0.26 ‚Üí 0.60-0.80 Sharpe (+0.35-0.55)
- Low risk, high reward
- Needed for 4-sleeve diversification

**Decision:** Fix HookCore first, then build ChopCore

---

### **Decision 2: TrendImpulse - Optimize Now or Later?**

**ANSWER: MINOR TWEAKS NOW, DEEP OPTIMIZATION LATER** ‚ö†Ô∏è

**Rationale:**
- Current Sharpe 0.42 is acceptable (not broken)
- Main issues: high turnover (630x), deep DD (-32%)
- Quick fix available: tighter low vol filter (test <0.40 vs <0.50)
- Deep optimization (lookback testing, position scaling) can wait

**Action Plan:**
- Day 1 Evening: Test stricter low vol threshold (30 min)
- If improves to 0.50+: keep it
- If not: leave as-is, optimize in Week 2-3

**Decision:** Small test now, full optimization Week 2-3

---

### **Decision 3: Order of Battle**

**ANSWER: SLEEVES ‚Üí REGIME SYSTEM ‚Üí OVERLAYS ‚Üí OPTIMIZATION**

**Sequence:**
1. **Week 1:** Get 4 strong sleeves working (fix HC, build ChopCore)
2. **Week 2:** Add regime-aware blending + overlays (tightness, ML)
3. **Week 3:** Optimize parameters, walk-forward validation
4. **Week 4:** Production prep, documentation

**Rationale:**
- Build foundation before sophistication
- Test each component independently
- Avoid premature optimization
- Incremental validation at each step

---

## üß† ITERATION PHILOSOPHY

### **The Renaissance Way‚Ñ¢**

```python
while improving:
    # 1. Validate current state
    measure_performance()
    
    # 2. Identify ONE bottleneck
    find_weakest_link()  # Don't fix everything at once
    
    # 3. Fix it simply
    implement_minimal_solution()  # Simplest thing that could work
    
    # 4. Test rigorously
    validate_improvement()  # IS/OOS, regime-stratified
    
    # 5. Only keep if it works
    if not better:
        revert()  # ‚Üê KEY: Don't be afraid to throw away work
    
    # 6. Document what you learned
    update_knowledge_base()  # Build institutional memory
```

### **Practical Rules**

1. **Always have a baseline** - Save current best before making changes
2. **One change at a time** - Never change 3 things simultaneously
3. **Quick tests first** - 5 min hypothesis checks before 5-day builds
4. **Automated validation** - Let code tell you if it's better
5. **Clear success criteria** - "Needs +0.10 Sharpe to justify complexity"
6. **Document failures** - Failed experiments teach as much as successes

### **When to Revert**

You're not going backwards when you revert - you're learning.

**Revert if:**
- New approach underperforms baseline by >0.05 Sharpe
- Complexity increases but performance doesn't (+20% code, +0.02 Sharpe = bad trade)
- Behavior becomes unexplainable (lost interpretability)
- Parameters require extreme fine-tuning (overfitting warning)

**Keep if:**
- Clear Sharpe improvement (>0.05) OR
- Same Sharpe but better risk profile (lower DD, less turnover) OR
- Interpretability improvement (understand why it works)

---

## üìö KEY DOCUMENTS & REFERENCE

### **Core Infrastructure Docs** (Read These)
- `INFRASTRUCTURE_STANDARDS.md` - Layer A/B architecture, file structure
- `QUICK_REFERENCE.md` - Building sleeves, validation, common errors
- `DEV_ENVIRONMENT.md` - Windows/VS Code setup, path conventions

### **Analysis Docs** (Strategic Understanding)
- `NEXT_SESSION_BRIEF.md` - Where we left off with sleeves Oct 31
- `historical_chop_analysis.md` - How to detect and trade rangebound markets
- `ml_and_tightness_index_summary.md` - Forward-looking adaptive strategies

### **Code Files** (Implementation)
- `contract.py` - Layer A (IMMUTABLE)
- `trendcore_v3.py` - Dual MA trend follower
- `trendimpulse_v4.py` - 20d momentum with regime scaling
- `hookcore_v4.py` - Mean reversion (needs fixing)

### **Data Files**
- `copper_lme_3mo_canonical.csv` - Main pricing series
- `copper_lme_1mo_impliedvol_canonical.csv` - Volatility data
- `copper_lme_total_stocks_canonical.csv` - Inventory levels
- `copper_lme_cash_3mo_canonical.csv` - Spread data

---

## üö® CRITICAL REMINDERS

### **Layer A Rules (NEVER BREAK)**
1. ‚ùå **NEVER modify `contract.py`** - All sleeves share the same execution
2. ‚úÖ **ALWAYS set `t_plus_one_pnl: true`** in YAML - Non-negotiable
3. ‚úÖ **ALWAYS validate outputs** - Run `validate_outputs.py` after every build
4. ‚úÖ **ALWAYS use lowercase in CSVs** - date, price, volume, iv (not Date, Price)

### **Development Rules**
1. üìù **Document hypothesis** - In YAML comments and function docstrings
2. üß™ **Test on 3+ years** - Need sufficient data for regime testing
3. üìä **Compare to baseline** - Simple trend following, buy-and-hold
4. ‚ö†Ô∏è **Watch for overfitting** - Test nearby parameters, check stability

### **When to Ask for Help**
- ‚ùå Validation consistently fails
- ‚ùå Results don't match economic intuition
- ‚ùå Sharpe extremely negative (<-1.0)
- ‚ùå Layer A seems wrong (it's not - check Layer B first!)

---

## üé¨ NEXT SESSION - IMMEDIATE ACTIONS

### **Hour 1: HookCore Fix** üîß

**Task:** Enable shorts + add regime filter

**Code changes needed:**
1. Modify `hookcore_v4.py` signal generation:
   - Add symmetric short logic (oversold ‚Üí long, overbought ‚Üí short)
   - Add regime filter (uptrends OR medium vol only)
   
2. Update `hookcore.yaml` config:
   - Document new logic
   - Set expected behavior

3. Run, validate, compare to v4

**Success metric:** Sharpe >0.50 (from 0.26)

---

### **Hour 2: TrendImpulse Quick Test** üéØ

**Task:** Test stricter low vol filter

**Changes:**
- Current: `low_vol_threshold: 0.40` (bottom 40%)
- Test: `low_vol_threshold: 0.35` (bottom 35%)

**Hypothesis:** Tighter focus on best regime should improve Sharpe

**Success metric:** Sharpe >0.50 (from 0.42)

---

### **Hour 3: ChopCore v1 Build** üèóÔ∏è

**Task:** Build range-bound specialist

**Implementation:**
1. Create `src\signals\chopcore_v1.py`
2. Bollinger mean reversion (20d, 2œÉ)
3. Volume confirmation (>1.2x average)
4. Chop regime filter (simple version: tight range + low vol)

**Test on:** 2011-12, 2015-16, 2018-19 chop periods

**Success metric:** Sharpe >0.40 overall, >0.60 in chop regimes

---

### **Hour 4: Re-Blend Portfolio** üéº

**Task:** Find optimal weights with 4 sleeves

**Method:**
- Grid search: test weights in 10% increments
- Calculate portfolio metrics for each combination
- Find max Sharpe combination

**Constraints:**
- Each sleeve ‚â•10% (diversification)
- Sum to 100%

**Success metric:** Portfolio Sharpe >0.70

---

## üìù SESSION TEMPLATE

**Use this at start of every session:**

```markdown
## Session Date: [DATE]
## Duration: [HOURS]
## Focus: [PRIMARY GOAL]

### Starting State
- Current portfolio Sharpe: [X.XX]
- Sleeves status: [list any issues]
- Last completed: [what we finished last time]

### Today's Goals
1. [Primary objective]
2. [Secondary objective]
3. [Stretch goal if time permits]

### Success Criteria
- Metric 1: [threshold]
- Metric 2: [threshold]
- Code changes: [what files modified]

### Session Log
[Time] - [Action taken]
[Time] - [Result observed]
[Time] - [Decision made]

### End State
- Achieved: [what worked]
- Blocked: [what didn't work]
- Next session: [what to tackle next]
```

---

## üîÆ VISION - WHERE WE'RE GOING

### **Phase 1: Copper MVP (4 weeks)** ‚Üê WE ARE HERE
- 4 sleeves working (TC, TI, HC, ChopCore)
- Regime-aware blending
- Tightness + ML overlays
- **Target: Sharpe 0.85+**

### **Phase 2: Advanced Features (Weeks 5-8)**
- Positioning data integration (CFTC, funds)
- Disruption index (mine outages)
- Enhanced chop detection (opposing forces, policy paralysis)
- Seasonal patterns
- **Target: Sharpe 0.90+**

### **Phase 3: Multi-Metal Expansion (Weeks 9-12)**
- Extend to aluminum, zinc, nickel
- Metal-specific parameter tuning
- Cross-metal correlations
- Basket strategies
- **Target: Full base metals coverage**

### **Phase 4: Production & Scale (Weeks 13-16)**
- Live trading (paper ‚Üí small size ‚Üí full size)
- Daily monitoring dashboard
- Automated reporting
- Risk management system
- **Target: Production deployment**

---

## üí™ WHY THIS WILL BE WORLD-CLASS

**Competitive Advantages:**

1. **Interpretability** - Always know WHY positioned this way
2. **Adaptability** - System adjusts to regime changes automatically
3. **Robustness** - Works across multiple market environments
4. **Auditable** - Every decision traces back to data
5. **Scalable** - Easy to extend to new metals, add sleeves
6. **Hybrid Edge** - Combines PM intuition + quant rigor (rare!)

**What Separates This From Others:**

- ‚ùå Pure quants: Don't understand metal fundamentals (data moat)
- ‚ùå Pure PMs: Can't systematize at scale (speed moat)
- ‚úÖ **Us:** Fundamental knowledge + systematic execution = edge

---

## üìå PINNED RESOURCES

**Quick Links:**
- Project structure: `C:\Code\Metals\`
- Data: `Data\copper\pricing\canonical\*.csv`
- Outputs: `outputs\Copper\[Sleeve]\`
- Config: `Config\Copper\[sleeve].yaml`

**Key Commands:**
```bash
# Build a sleeve
run_[sleeve].bat

# Validate outputs
python tools\validate_outputs.py --outdir outputs\Copper\[Sleeve]

# View results
type outputs\Copper\[Sleeve]\summary_metrics.json
```

**Working Hours:** 8 hours/day available

**Max Plan:** Enabled (can run multiple tasks, longer sessions)

---

## ‚úÖ STATUS: READY TO BUILD

**Current State:** Solid foundation with 3 sleeves, clear path forward

**Next Milestone:** Fix HookCore + build ChopCore ‚Üí 4-sleeve portfolio

**Timeline:** Week 1 starts NOW

**Confidence:** HIGH - Clear bottlenecks, proven fixes, realistic targets

---

**Let's build something exceptional.** üöÄ

---

*Last Updated: November 4, 2025*  
*Version: 1.0*  
*Next Review: After Week 1 completion*