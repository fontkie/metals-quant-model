# Config/Copper/tightstocks_v1.yaml
# TightStocks v1 - Continuous IIS Signal
# Physical market fundamental edge systematized

# Metadata
io:
  commodity: Copper
  sleeve: TightStocks_v1
  description: "Continuous Inventory Investment Surprise signal from global exchange stocks"
  strategy_type: "quantamental"  # Combines fundamental data with systematic execution

# Layer A policy (immutable contract)
policy:
  calendar:
    frequency: daily
    timezone: UTC
    
  sizing:
    ann_target: 0.10  # 10% annualized vol target
    vol_lookback_days_default: 21
    leverage_cap_default: 2.5
    strategy_type: sparse  # Long-only, selective positioning
    
  costs:
    one_way_bps_default: 3.0  # LME copper typical spread
    cost_model: linear_per_trade
    
  pnl:
    t_plus_one_pnl: true  # REQUIRED: T-1 position earns T return

# Layer B signal parameters
signal:
  # IIS calculation
  change_window: 10      # Days for stock change (10 = 2 weeks)
  z_window: 252          # Days for z-score normalization (252 = 1 year)
  
  # Exchange weighting
  lme_weight: 0.60       # LME is global benchmark, highest weight
  comex_weight: 0.25     # COMEX adds US flow information
  shfe_weight: 0.15      # SHFE adds China demand, discounted for noise
  
  # Position scaling  
  scale_factor: 2.0      # IIS divisor (2.0 = IIS=-2 gives pos=1.0)
  max_raw_position: 1.0  # Cap on signal (before vol targeting)
  
  # Publication lag
  signal_lag: 1          # shift(1): use T-1 stocks for T position
                         # Verified: morning publication → EOD execution

# Expected performance (validation)
expected_performance:
  sharpe_is: 0.666      # In-sample (2004-2018)
  sharpe_oos: 0.774     # Out-of-sample (2019-2025)
  degradation_pct: 16.1 # +16.1% = IMPROVED in OOS (rare!)
  correlation_vs_price_sleeves: 0.06  # Uncorrelated = diversification
  
# Signal rationale
rationale:
  economic_hypothesis: "Physical market tightness (surprise destocking) predicts price appreciation independent of technical trends"
  
  why_weighted_combination: >
    LME dominates (60%) as global benchmark.
    COMEX (25%) captures US flows and arb opportunities.
    SHFE (15%) captures China demand but discounted for data quality.
    
  why_continuous_not_binary: >
    Binary thresholds are fragile (cliff problem at -1.0 vs -1.2).
    Continuous signal uses ALL information (IIS=-1.5 > IIS=-1.0).
    More statistically stable (+16% OOS improvement).
    Compatible with 15% floor constraints.
    
  why_long_only: >
    Surprise destocking (IIS < 0) predicts price appreciation.
    Surprise building (IIS > 0) less predictive, so stay flat.
    Asymmetric signal reflects market structure.
    
  differentiation: >
    This is THE QUANTAMENTAL EDGE.
    Not just price momentum; physical market fundamentals systematized.
    Same signals I traded discretionary at Andurand, now scalable.

# Data requirements
data:
  required_files:
    - "copper_lme_3mo.canonical.csv"                      # Price data
    - "copper_lme_onwarrant_stocks.canonical.csv"         # LME on-warrant
    - "copper_comex_stocks.canonical.csv"                 # COMEX warehouse
    - "copper_shfe_onwarrant_stocks.canonical.csv"        # SHFE on-warrant
  
  format:
    price: "date,price (lowercase)"
    stocks: "date,stocks (or exchange-specific column)"
  
  notes:
    - "SHFE data starts ~2003, limits backtest to 2004+"
    - "Use on-warrant stocks (not total) for LME/SHFE"
    - "Forward-fill stock data for weekends/holidays"
    - "Z-score requires 252 days warmup"

# Forward bias audit
forward_bias_check:
  stock_change: "Uses T and T-10 (past only) ✓"
  z_score: "Rolling window uses past 252 days only ✓"
  signal_shift: "shift(1) for publication lag ✓"
  pnl_accrual: "T-1 position earns T return ✓"
  conclusion: "NO FORWARD BIAS - production ready ✓"
  
  critical_assumption: >
    LME publishes Thursday morning (9am) with Wednesday's stocks.
    COMEX publication timing TBD - verify before production.
    If COMEX publishes AFTER LME close, need shift(2) for COMEX component.

# Version history
version_history:
  v1.0:
    date: "2025-11-15"
    changes:
      - "Initial implementation with continuous IIS signal"
      - "Weighted exchange combination (60/25/15)"
      - "Linear position scaling (no binary threshold)"
      - "Long-only with vol targeting"
    validation: "0.666 IS Sharpe, 0.774 OOS Sharpe, +16.1% OOS improvement"
    status: "Production ready (pending COMEX timing verification)"