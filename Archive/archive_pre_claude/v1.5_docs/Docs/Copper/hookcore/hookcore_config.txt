# Hookcore v1.5 — Mean-Reversion Sleeve (Copper 3M)
# Purpose: Short-hold, regime-filtered mean reversion for choppy markets.
# This YAML documents the final, deployable spec so another quant can fully reproduce results.

sleeve:
  name: Hookcore
  version: "v1.5"
  asset: "LME Copper 3M"
  description: "Bollinger-band mean reversion with choppy-regime filters; T execution, PnL from T+1; rolling vol target 10%."

data:
  input_file: "pricing_values.xlsx"
  date_column: "Date"
  date_parse:
    excel_origin: "1899-12-30"
    method: "pd.to_datetime('1899-12-30') + pd.to_timedelta(df['Date'], unit='D')"
  price_column: "copper_lme_3mo"
  calendar:
    policy: "source_dates_only"          # use only dates present in the file
    forward_fill_across_holidays: false  # do not reindex to weekdays or ffill across missing trading days
    holiday_calendar_hint: "LME"         # optional: align to LME holidays in future versions
  cleaning:
    drop_duplicate_dates: true
    drop_na_prices: true
  returns:
    definition: "ret_t = price_t / price_{t-1} - 1"
    frequency: "daily"

execution:
  decision_time: "T close"
  execute_at: "T"                        # trade at today's settle
  pnl_begins: "T+1"                      # no same-day PnL; costs on entry day only
  allow_overlaps: true                   # multiple concurrent 3-day holds
  entry_costs:
    entry_bps: 1.5                       # sensitivity: 3.0 bps also tested
    exit_bps: 0.0
  latency_assumption:
    bands_shifted: true                  # μ/σ shifted by 1 bar (risk-safe, no settle-time dependency)
    requires_settle_compute: false       # set to true only if using unshifted μ/σ

signal:
  bollinger:
    lookback_days: 5
    sigma_multiplier: 1.5
    shift_bars: 1                        # 1 = use info up to T-1 (no look-ahead)
  filters:                               # all must be true for activation
    non_trending:
      lookback_days: 10
      threshold_abs_cumret: 0.05         # |px_t/px_{t-10}-1| < 5%
    low_vol:
      lookback_days: 20
      threshold_daily_std: 0.02          # std(ret, 20) < 2% (daily)
    reversion_hint:
      autocorr_lag: 1
      lookback_days: 10
      threshold_corr: -0.1               # corr_10(ret, ret.shift(1)) < -0.1
  entry_logic:
    long:  "price_t < lower_band_t AND filters_ok"
    short: "price_t > upper_band_t AND filters_ok"
    flat:  "otherwise"
  holding:
    hold_days_trading: 3                 # entry day + next 2 trading days; PnL accrues only on T+1, T+2

position_sizing:
  target_vol_annual: 0.10                # 10%
  realized_vol_window_days: 63
  scale_method: "rolling"
  scale_input: "strategy_ret_unscaled"
  scale_lag_days: 1                      # use history up to T-1
  clamp:
    min: 0.5
    max: 1.5

testing:
  periods:
    in_sample:
      start: "2008-01-01"
      end:   "2017-12-31"
    out_of_sample:
      start: "2018-01-01"
      end:   "present"
  costs_sensitivity_bps: [1.5, 3.0]
  execution_variants:
    t_execution_shifted_bands: true      # canonical, deployable
    t_execution_unshifted_bands: false   # optional (requires guaranteed settle-time compute)
    t_plus_1_execution: false            # available as realism test; keep off for final v1.5

metrics:
  report:
    - annual_return
    - annual_vol
    - sharpe
    - sharpe_newey_west_lag5
    - sortino
    - max_drawdown
    - calmar
    - trades_per_year
    - turnover_x
    - hit_rate
    - avg_win
    - avg_loss
    - skew
    - kurtosis
    - pct_days_active
  definitions:
    annual_return: "(1 + mean_daily_ret)^252 - 1"
    annual_vol: "std_daily_ret * sqrt(252)"
    sharpe: "mean/std * sqrt(252)"
    sharpe_newey_west_lag5: "HAC-adjusted Sharpe with Bartlett kernel, lag=5"
    pct_days_active: "share of days with non-zero exposure_for_pnl"

outputs:
  daily_series_csv: "outputs/Copper/Hookcore/daily_series.csv"
  summary_csv:      "outputs/Copper/Hookcore/summary_IS_OOS.csv"
  daily_series_columns:
    - date
    - price
    - ret
    - upper_band
    - lower_band
    - filters_ok
    - signal_T
    - exposure_for_pnl
    - raw_pnl
    - entry_costs
    - strategy_ret_unscaled
    - scale_t
    - strategy_ret_scaled

audit_checks:
  no_lookahead:
    - "Bands shifted by 1 bar (μ/σ at T-1)"
    - "Filters computed with info available at decision time"
  pnl_timing:
    - "No same-day PnL (only entry costs on T)"
    - "PnL accrues on T+1 and T+2 for each entry"
  calendar_integrity:
    - "No reindexing to weekdays"
    - "No forward-fill across non-trading gaps"
  scaling_integrity:
    - "Rolling 63D vol uses returns up to T-1"
    - "Clamp scale to [0.5, 1.5]"
  cost_realism:
    - "Run 1.5 bps and 3.0 bps sensitivities"
  reproducibility:
    - "Fix pandas/numpy versions in environment.yml or requirements.txt"
    - "Results should match to rounding tolerance (±1bp cumulative)"

notes:
  rationale: "Mean-reversion in non-trending, low-vol regimes; short holds reduce regime exposure; filters reduce whipsaw."
  deployment: "Default to shifted bands for risk-safe ops. If unshifted is used, document settle-time compute dependency in sleeve YAML."
