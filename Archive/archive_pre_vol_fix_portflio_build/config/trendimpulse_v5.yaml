# Config/Copper/trendimpulse_v5.yaml

io:
  commodity: Copper
  sleeve: TrendImpulse_v5

policy:
  calendar:
    exec_weekdays: [0, 1, 2, 3, 4]  # Mon-Fri
    origin_for_exec:
      "0": "-1B"
      "1": "-1B"
      "2": "-1B"
      "3": "-1B"
      "4": "-1B"
    fill_default: close_T

  sizing:
    ann_target: 0.10                    # 10% target vol
    vol_lookback_days_default: 63       # ~3 months rolling vol
    leverage_cap_default: 3.0           # Max 3x leverage (Layer 2 will handle)

  costs:
    one_way_bps_default: 3.0            # 3 bps per trade (institutional reality)

  pnl:
    formula: pos_lag_times_simple_return
    t_plus_one_pnl: true                # T+1 accrual

# TrendImpulse v5 signal parameters (LAYER 1 ONLY)
signal:
  # Core strategy
  strategy_version: "5.0"
  description: "Quality Momentum with Regime Scaling - 4-Layer Architecture"
  architecture: "Pure signal in Layer 1, vol targeting in Layer 2, costs in Layer 4"
  
  # Momentum parameters
  momentum_window: 20                   # 20-day momentum lookback
  
  # Asymmetric entry/exit (v5 key improvement)
  entry_threshold: 0.010                # 1.0% - need conviction to enter
  exit_threshold: 0.003                 # 0.3% - patient exit
  reason_asymmetric: "Reduces whipsaw in choppy markets, improves win rate"
  
  # Turnover reduction
  weekly_vol_updates: true              # Update vol/regime weekly (not daily)
  update_frequency: 5                   # Update every 5 trading days
  reason_weekly: "Reduces turnover by ~40% vs daily updates"
  
  # Regime scaling (strategic decision about when to be aggressive)
  use_regime_scaling: true
  vol_window: 63                        # Vol calculation window
  vol_percentile_window: 252            # Percentile ranking window
  low_vol_threshold: 0.40               # Bottom 40% = low vol
  medium_vol_threshold: 0.75            # 40-75% = medium vol
  low_vol_scale: 1.5                    # 1.5x in low vol (Sharpe 0.658)
  medium_vol_scale: 0.4                 # 0.4x in medium vol (Sharpe 0.062)
  high_vol_scale: 0.7                   # 0.7x in high vol (Sharpe 0.079)
  reason_regime: "Overweight low vol edge, underweight weak medium vol"
  
  # Notes on Layer 1
  notes:
    - "Pure signal generation with regime-based strategic scaling"
    - "Regime scaling is STRATEGIC (when to be aggressive), not calibration"
    - "Vol targeting applied separately in Layer 2 (closed-loop EWMA)"
    - "Costs applied once on net portfolio in Layer 4"
    - "Expected raw signal: -1.5 to +1.5 (due to regime scaling)"

# Expected performance (validated 2000-2025, after full 4-layer processing)
expected_performance:
  gross_sharpe: 0.48              # ~0.48 before costs
  net_sharpe: 0.42                # ~0.42 after 3bps costs
  annual_return: 0.042            # 4.2% @ 3bps
  annual_vol: 0.10                # 10% (via closed-loop vol targeting)
  max_drawdown: -0.24             # -24% (true risk)
  turnover: 630                   # 630x annual (high but profitable)
  activity: 0.90                  # 90% time in market
  
  validation:
    data_period: "2000-2025"
    observations: 6718
    note: "Validated on 25 years of copper LME 3mo data with 4-layer architecture"

# Cost impact analysis
cost_analysis:
  gross_sharpe: 0.48
  cost_drag: 0.06                 # 0.06 Sharpe points @ 3bps
  net_sharpe: 0.42
  cost_as_pct_gross: 0.125        # ~12.5% of gross returns
  note: "High turnover but strong gross Sharpe makes it viable"

# Portfolio contribution
portfolio_metrics:
  correlation_trendcore: 0.42
  correlation_momentumcore: 0.28
  diversification: "LOW correlation with slower strategies"
  
  standalone_net_sharpe: 0.42
  role: "Fast money, captures short-term momentum bursts"
  
  three_sleeve_blend:
    allocation: "50% TrendCore / 25% MomentumCore / 25% TrendImpulse"
    expected_sharpe: 0.66
    improvement: "+24% vs current"
  
  recommendation: "Keep at 25% for diversification, accept high turnover"

# Comparison to TrendImpulse v4
vs_v4:
  v4_architecture: "Monolithic with embedded vol scaling"
  v5_architecture: "Clean 4-layer separation"
  v4_costs: "Applied inline (potential double-counting)"
  v5_costs: "Applied ONCE on net position (correct)"
  v4_vol_targeting: "Manual scaling"
  v5_vol_targeting: "Closed-loop EWMA targeting"
  improvement: "Same performance, cleaner implementation, institutional credibility"

# Data requirements
data:
  required:
    - copper_lme_3mo.canonical.csv    # Price data only
  
  optional:
    - None                             # No external regime data needed
  
  notes:
    - "Strategy self-generates regime classification from price vol"
    - "20-day lookback requires 20 days warmup"
    - "Vol regime needs 252 days for percentile calculation"

# Architecture notes
architecture:
  layer_1: "generate_trendimpulse_signal() - pure signal with regime scaling"
  layer_2: "apply_vol_targeting() - closed-loop EWMA targeting"
  layer_3: "Single sleeve for now (future: regime-based blending)"
  layer_4: "execute_single_sleeve() - costs once on net position"
  
  critical:
    - "Regime scaling is STRATEGIC (Layer 1), not calibration"
    - "NO vol targeting in signal function"
    - "Costs applied ONCE on net portfolio (institutional standard)"
    - "Closed-loop vol targeting ensures 10% realized vol"
    - "All validation checks must pass"
  
  design_decisions:
    - "Asymmetric thresholds reduce whipsaw trades"
    - "Weekly updates reduce turnover while maintaining edge"
    - "Regime scaling captures low-vol edge (Sharpe 0.658)"
    - "High turnover acceptable due to strong gross Sharpe (0.48)"